{% extends 'quotes/index.html' %}

{% block content %}
<div class="row">
    <div class="col-lg-8">
        {% if quote %}
        <div class="card quote-card mb-4">
            <div class="card-body">
                <div class="quote-text">
                    <i class="fas fa-quote-left text-muted me-2"></i>
                    {{ quote.text }}
                    <i class="fas fa-quote-right text-muted ms-2"></i>
                </div>

                <div class="d-flex justify-content-between align-items-center mt-3">
                    <div>
                        <footer class="blockquote-footer quote-source">
                            <i class="fas fa-film me-1"></i>{{ quote.source }}
                            <span class="text-muted quote-views ms-2">
                                <i class="fas fa-eye me-1"></i>{{ quote.views_count }}
                            </span>
                        </footer>
                    </div>

                    <div class="btn-group">
                        <button id="like-btn-{{ quote.id }}" onclick="rateQuote({{ quote.id }}, 'like')"
                                class="btn btn-outline-success btn-sm like-btn">
                            <i class="fas fa-thumbs-up me-1"></i>
                            <span id="likes-count-{{ quote.id }}">{{ quote.likes }}</span>
                        </button>
                        <button id="dislike-btn-{{ quote.id }}" onclick="rateQuote({{ quote.id }}, 'dislike')"
                                class="btn btn-outline-danger btn-sm dislike-btn">
                            <i class="fas fa-thumbs-down me-1"></i>
                            <span id="dislikes-count-{{ quote.id }}">{{ quote.dislikes }}</span>
                        </button>
                    </div>
                </div>
            </div>
        </div>
        {% else %}
        <div class="alert alert-info text-center">
            <i class="fas fa-info-circle me-2"></i>
            –ü–æ–∫–∞ –Ω–µ—Ç —Ü–∏—Ç–∞—Ç. –î–æ–±–∞–≤—å—Ç–µ –ø–µ—Ä–≤—É—é!
        </div>
        {% endif %}
    </div>

    <div class="col-lg-4">
        <div class="card">
            <div class="card-header">
                <h5 class="mb-0">
                    <i class="fas fa-plus-circle me-2"></i>
                    –î–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—É—é —Ü–∏—Ç–∞—Ç—É
                </h5>
            </div>
            <div class="card-body">
                {% if messages %}
                    {% for message in messages %}
                        {% if message.tags == 'success' %}
                            <div class="alert alert-success">
                                <i class="fas fa-check-circle me-2"></i>{{ message }}
                            </div>
                        {% elif message.tags == 'error' %}
                            <div class="alert alert-danger">
                                <i class="fas fa-exclamation-circle me-2"></i>{{ message }}
                            </div>
                        {% else %}
                            <div class="alert alert-{{ message.tags }}">
                                <i class="fas fa-info-circle me-2"></i>{{ message }}
                            </div>
                        {% endif %}
                    {% endfor %}
                {% endif %}

                <form method="post">
                    {% csrf_token %}

                    <div class="mb-3">
                        <label class="form-label">
                            <i class="fas fa-quote-right me-1"></i>–¢–µ–∫—Å—Ç —Ü–∏—Ç–∞—Ç—ã
                        </label>
                        {{ form.text }}
                    </div>

                    <div class="mb-3">
                        <label class="form-label">
                            <i class="fas fa-book me-1"></i>–ù–∞–∑–≤–∞–Ω–∏–µ –∏—Å—Ç–æ—á–Ω–∏–∫–∞
                        </label>
                        <input type="text" name="source_name" class="form-control"
                               placeholder="–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –∏—Å—Ç–æ—á–Ω–∏–∫–∞" required>
                    </div>

                    <div class="mb-3">
                        <label class="form-label">
                            <i class="fas fa-tag me-1"></i>–¢–∏–ø –∏—Å—Ç–æ—á–Ω–∏–∫–∞
                        </label>
                        <select name="source_type" class="form-select" required>
                            <option value="">–í—ã–±–µ—Ä–∏—Ç–µ —Ç–∏–ø –∏—Å—Ç–æ—á–Ω–∏–∫–∞...</option>
                            <option value="movie">üé¨ –§–∏–ª—å–º</option>
                            <option value="book">üìö –ö–Ω–∏–≥–∞</option>
                            <option value="song">üéµ –ü–µ—Å–Ω—è</option>
                            <option value="other">üîÆ –î—Ä—É–≥–æ–µ</option>
                        </select>
                    </div>

                    <div class="mb-3">
                        <label class="form-label">
                            <i class="fas fa-weight-hanging me-1"></i>–í–µ—Å
                        </label>
                        {{ form.weight }}
                        <div class="form-text">–ß–µ–º –±–æ–ª—å—à–µ –≤–µ—Å, —Ç–µ–º —á–∞—â–µ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è —Ü–∏—Ç–∞—Ç–∞</div>
                    </div>

                    <button type="submit" class="btn btn-primary w-100">
                        <i class="fas fa-plus me-2"></i>–î–æ–±–∞–≤–∏—Ç—å —Ü–∏—Ç–∞—Ç—É
                    </button>
                </form>
            </div>
        </div>
    </div>
</div>

<script>
function rateQuote(quoteId, action) {
    const likeBtn = document.getElementById(`like-btn-${quoteId}`);
    const dislikeBtn = document.getElementById(`dislike-btn-${quoteId}`);

    // –í–∏–∑—É–∞–ª—å–Ω–∞—è –æ–±—Ä–∞—Ç–Ω–∞—è —Å–≤—è–∑—å
    if (action === 'like') {
        likeBtn.classList.add('btn-success');
        likeBtn.classList.remove('btn-outline-success');
        setTimeout(() => {
            likeBtn.classList.remove('btn-success');
            likeBtn.classList.add('btn-outline-success');
        }, 500);
    } else {
        dislikeBtn.classList.add('btn-danger');
        dislikeBtn.classList.remove('btn-outline-danger');
        setTimeout(() => {
            dislikeBtn.classList.remove('btn-danger');
            dislikeBtn.classList.add('btn-outline-danger');
        }, 500);
    }

    fetch(`/quote/${quoteId}/${action}/`, {
        method: 'POST',
        headers: {
            'X-CSRFToken': '{{ csrf_token }}',
            'Content-Type': 'application/json',
        }
    })
    .then(response => {
        if (!response.ok) {
            throw new Error('Network response was not ok');
        }
        return response.json();
    })
    .then(data => {
        if (data.status === 'success') {
            document.getElementById(`likes-count-${quoteId}`).textContent = data.likes;
            document.getElementById(`dislikes-count-${quoteId}`).textContent = data.dislikes;
        } else {
            alert('–û—à–∏–±–∫–∞: ' + data.error);
        }
    })
    .catch(error => {
        console.error('Error:', error);
        alert('–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Ü–µ–Ω–∫–µ —Ü–∏—Ç–∞—Ç—ã');
    });
}

// –î–æ–±–∞–≤–ª—è–µ–º —Å—Ç–∏–ª–∏ –¥–ª—è –ø–æ–ª–µ–π —Ñ–æ—Ä–º—ã
document.addEventListener('DOMContentLoaded', function() {
    const textarea = document.querySelector('textarea');
    if (textarea) {
        textarea.classList.add('form-control');
        textarea.setAttribute('rows', '4');
        textarea.setAttribute('placeholder', '–í–≤–µ–¥–∏—Ç–µ —Ç–µ–∫—Å—Ç —Ü–∏—Ç–∞—Ç—ã...');
    }

    const weightInput = document.querySelector('input[type="number"]');
    if (weightInput) {
        weightInput.classList.add('form-control');
        weightInput.setAttribute('min', '1');
        weightInput.setAttribute('max', '100');
        weightInput.setAttribute('value', '10');
    }
});
</script>

<style>
.quote-text {
    font-size: 1.3rem;
    line-height: 1.6;
    color: #2c3e50;
    font-style: italic;
    padding: 1.5rem;
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
}

.card {
    border: none;
    border-radius: 15px;
    box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
    transition: transform 0.3s ease;
}

.card:hover {
    transform: translateY(-2px);
}

.btn-group .btn {
    border-radius: 8px;
    margin: 0 2px;
}

.form-control, .form-select {
    border-radius: 10px;
    border: 2px solid #e9ecef;
    transition: all 0.3s ease;
}

.form-control:focus, .form-select:focus {
    border-color: #667eea;
    box-shadow: 0 0 0 0.3rem rgba(102, 126, 234, 0.25);
}

.alert {
    border-radius: 10px;
    border: none;
}
</style>
{% endblock %}